<!DOCTYPE HTML>
<html>
<head>
    <title>Connect to Your PZH</title>
    <link rel="stylesheet" type="text/css" href="css/reset.css">
    <link rel="stylesheet" type="text/css" href="css/structure.css">
    <link rel="stylesheet" type="text/css" href="css/login.css">
    <script type="text/javascript" src="./jquery-1.8.2.min.js" ></script>
    <script type="text/javascript" src="../webinos.js" ></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $("#connectPzh").click( function() {
                if (document.getElementById("own_pzh") && document.getElementById("own_pzh").value !== "undefined" &&
                        document.getElementById("own_pzh").value !== "") {
                    value = document.getElementById("own_pzh").value;
                } else {
                    value = $("#pzh_list option:selected").val();
                }
                $("#provider").hide();

                $('#main').html('<article class="module width_full">' +
                        '<header><h3> Login to your personal zone hub - '+(value)+' </h3></header>' +
                        '<div class="module_content">' +
                        '<iframe frameborder="0" width="100%" height="100%" src="https://'+value+'?isPzp=true"></iframe>' +
                        '</div>' +
                        '</article>');

                function load(event) {
                    if(event.origin === "https://"+value){
                        var msg = event.data, options;
                        if (msg.cmd === "requestEnroll") {
                            options = {type: 'prop', payload: {status:'enrollPzp', pzhId: msg.pzhId,
                                providerAddress: value, authCode: msg.authCode}};
                            webinos.session.message_send(options);
                        }
                    }
                }
                window.addEventListener('message', load, false);
            });
        });
    </script>

</head>
<body>
<form class="box login" id="provider">
    <header>
        <img src="http://webinos.org/wp-content/themes/parallelus-unite/images/webinos_logo.png" width="100px">
        <label>Connect your device to a personal zone hub (PZH) </label>
    </header>
    <fieldset class="boxBody">
        <label>Select your personal zone hub provider</label>
        <select value="pzh_list" id="pzh_list">
            <option value="pzh.webinos.org"> pzh.webinos.org </option>
        </select>
        <label> (Or) Enter the address</label>
        <input type="text" value="" id="own_pzh"> </input>
        <input type="button" class="btnLogin" id="connectPzh" value="Login to Your PZH!">
        <submit> </submit>
    </fieldset>
</form>
<footer id="main">
    <a href="http://wwww.webinos.org">Powered by webinos</a> | <a href="http://developer.webinos.org">Developer resources on webinos</a>
</footer>
</body>
</html>
